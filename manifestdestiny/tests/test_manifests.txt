Test the manifest parser
========================

Ensure basic parser is sane:

    >>> from manifestdestiny import ManifestParser
    >>> parser = ManifestParser()
    >>> parser.read('mozmill-example.ini')
    >>> tests = parser.tests
    >>> len(tests) == len(file('mozmill-example.ini').read().strip().splitlines())
    True
    
Ensure that capitalization and order aren't an issue:

    >>> lines = ['[%s]' % test for test in tests]
    >>> lines == file('mozmill-example.ini').read().strip().splitlines()
    True

Show how you select subsets of tests:

    >>> parser.read('mozmill-restart-example.ini')
    >>> restart_tests = parser.get(type='restart')
    >>> len(restart_tests) < len(parser.tests)
    True
    >>> len(restart_tests) == len(parser.get(manifest='mozmill-restart-example.ini'))
    True
    >>> assert not [i for i in restart_tests if restart_tests[i]['manifest'] != 'mozmill-restart-example.ini']
    >>> parser.get('foo').keys()
    ['restartTests/testExtensionInstallUninstall/test2.js', 'restartTests/testExtensionInstallUninstall/test1.js']
    >>> parser.get(foo='bar').keys()
    ['restartTests/testExtensionInstallUninstall/test2.js']

Illustrate how include works:

    >>> parser = ManifestParser()
    >>> parser.read('include-example.ini')

All of the tests should be included, in order:

    >>> import os    
    >>> parser.tests.keys()
    ['crash-handling', 'fleem', 'flowers']
    >>> [(key, os.path.basename(parser.tests[key]['manifest'])) for key in parser.tests]
    [('crash-handling', 'bar.ini'), ('fleem', 'include-example.ini'), ('flowers', 'foo.ini')]

DEFAULT values should persist across includes, unless they're
overwritten.  In this example, include-example.ini sets foo=bar, but
its overridden to fleem in bar.ini:

    >>> parser.get(foo='bar').keys()
    ['fleem', 'flowers']
    >>> parser.get(foo='fleem').keys()
    ['crash-handling']

Passing parameters in the include section allows defining variables in
the submodule scope:

    >>> parser.get('red').keys()
    ['flowers']

However, this should be overridable from the DEFAULT section in the
included file and that overridable via the key directly connected to
the test:

    >>> parser.tests['flowers']['blue']
    'ocean'
    >>> parser.tests['flowers']['yellow']
    'submarine'
