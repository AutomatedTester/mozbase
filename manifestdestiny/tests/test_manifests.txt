Test the manifest parser
========================

Ensure basic parser is sane:

    >>> from manifestdestiny import ManifestParser
    >>> parser = ManifestParser()
    >>> parser.read('mozmill-example.ini')
    >>> tests = parser.tests
    >>> len(tests) == len(file('mozmill-example.ini').read().strip().splitlines())
    True
    
Ensure that capitalization and order aren't an issue:

    >>> lines = ['[%s]' % test['name'] for test in tests]
    >>> lines == file('mozmill-example.ini').read().strip().splitlines()
    True

Show how you select subsets of tests:

    >>> parser.read('mozmill-restart-example.ini')
    >>> restart_tests = parser.get(type='restart')
    >>> len(restart_tests) < len(parser.tests)
    True
    >>> len(restart_tests) == len(parser.get(manifest='mozmill-restart-example.ini'))
    True
    >>> assert not [test for test in restart_tests if test['manifest'] != 'mozmill-restart-example.ini']
    >>> parser.get('name', tags=['foo'])
    ['restartTests/testExtensionInstallUninstall/test2.js', 'restartTests/testExtensionInstallUninstall/test1.js']
    >>> parser.get('name', foo='bar')
    ['restartTests/testExtensionInstallUninstall/test2.js']

Illustrate how include works:

    >>> parser = ManifestParser(manifests=('include-example.ini',))

All of the tests should be included, in order:

    >>> import os    
    >>> parser.get('name')
    ['crash-handling', 'fleem', 'flowers']
    >>> [(test['name'], os.path.basename(test['manifest'])) for test in parser.tests]
    [('crash-handling', 'bar.ini'), ('fleem', 'include-example.ini'), ('flowers', 'foo.ini')]

DEFAULT values should persist across includes, unless they're
overwritten.  In this example, include-example.ini sets foo=bar, but
its overridden to fleem in bar.ini:

    >>> parser.get('name', foo='bar')
    ['fleem', 'flowers']
    >>> parser.get('name', foo='fleem')
    ['crash-handling']

Passing parameters in the include section allows defining variables in
the submodule scope:

    >>> parser.get('name', tags=['red'])
    ['flowers']

However, this should be overridable from the DEFAULT section in the
included file and that overridable via the key directly connected to
the test:

    >>> parser.get(name='flowers')[0]['blue']
    'ocean'
    >>> parser.get(name='flowers')[0]['yellow']
    'submarine'

Using the inverse flag should invert the set of tests returned:

    >>> parser.get('name', inverse=True, tags=['red'])
    ['crash-handling', 'fleem']
